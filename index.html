<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>互動藝術介面 - 音量控制波浪</title>
  <!-- 載入 p5.js 與 p5.sound.js -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/addons/p5.sound.min.js"></script>
</head>
<body>

<script>
// 宣告麥克風物件
let mic;

// 畫布設定
function setup() {
  createCanvas(windowWidth, windowHeight);

  // 建立並啟動麥克風輸入
  mic = new p5.AudioIn();
  mic.start();
}

function draw() {
  background(240);

  // 從麥克風取得當前音量 (0~1)
  let audioLevel = mic.getLevel();

  // 將音量映射成較大的振幅 (可視需求調整 0~300、0~500...)
  let amplitude = map(audioLevel, 0, 1, 0, 400);

  // 線條參數設定
  stroke(0);
  strokeWeight(2);
  noFill();

  // 波浪數量 & 垂直間隔
  let numberOfWaves = 15;
  let waveGap = height / numberOfWaves;

  // 時間相位，讓波浪產生流動感
  let speed = 0.02;
  let phase = frameCount * speed;

  // 繪製多條波浪
  for (let i = 0; i < numberOfWaves; i++) {
    beginShape();
    let yBase = i * waveGap + waveGap / 2;
    for (let x = 0; x <= width; x += 10) {
      let wave = sin(x * 0.02 + phase + i) * amplitude;
      let y = yBase + wave;
      vertex(x, y);
    }
    endShape();
  }
}

// 若視窗大小改變，讓畫布隨之重設
function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}
</script>

</body>
</html>
