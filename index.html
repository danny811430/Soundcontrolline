<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>互動藝術介面 - 親子展遊戲</title>
  <!-- 載入 p5.js 程式庫 -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
  <!-- 載入 p5.sound 程式庫 (提供麥克風音量功能) -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/addons/p5.sound.min.js"></script>
</head>
<body>
<script>
// 宣告麥克風變數
let mic;

function setup() {
  createCanvas(windowWidth, windowHeight);
  // 初始化麥克風並啟動
  mic = new p5.AudioIn();
  mic.start();
}

function draw() {
  background(240);
  
  stroke(0);
  strokeWeight(2);
  noFill();
  
  // 取得麥克風音量 (值通常介於 0~1)
  let vol = mic.getLevel();
  
  // 判斷輸入來源：
  // 若有觸控，則用觸控的 Y 軸；否則使用滑鼠的 X 軸控制
  let inputValue;
  let mappingRange;
  if (touches.length > 0) {
    // 手機觸控模式：以觸控第一點的 Y 值控制
    inputValue = touches[0].y;
    mappingRange = height;
  } else {
    // 桌面模式：以滑鼠 X 軸位置控制
    inputValue = mouseX;
    mappingRange = width;
  }
  
  // 將輸入值映射至基礎振幅 (0~200)
  let baseAmplitude = map(inputValue, 0, mappingRange, 0, 200);
  
  // 根據麥克風音量調整振幅
  // 這裡用 (1 + vol * 5) 當作乘數，根據實際情況可調整倍率
  let amplitude = baseAmplitude * (1 + vol * 5);
  
  let numberOfWaves = 15;             // 波浪條數
  let waveGap = height / numberOfWaves; // 每條之間的垂直間隔
  
  let speed = 0.02;                   // 波浪移動速度
  let phase = frameCount * speed;
  
  // 繪製每一條波浪
  for (let i = 0; i < numberOfWaves; i++) {
    beginShape();
    let yBase = i * waveGap + waveGap / 2;
    for (let x = 0; x <= width; x += 10) {
      let wave = sin(x * 0.02 + phase + i) * amplitude;
      let y = yBase + wave;
      vertex(x, y);
    }
    endShape();
  }
}
</script>
</body>
</html>
